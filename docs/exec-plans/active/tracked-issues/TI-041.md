# TI-041 — Task A3.1 — Add security smoke script (authN/authZ checks, lockout checks)

- **Status:** Open
- **Owner role:** QA Engineer
- **Effort:** M
- **Dependencies:** Role matrix from TI-002; timeout/re-auth policy from TI-003

## Definition of done

- Security smoke command set is documented for authN/authZ and lockout checks.
- Script inputs/outputs and pass/fail criteria are defined for pre-release execution.
- Results are required evidence for release readiness review.

## Implementation scope (explicit in-repo targets)

- `docs/exec-plans/active/tracked-issues/TI-041.md`
  - Canonical smoke command matrix + pass/fail signatures.
- `docs/exec-plans/active/2026-02-25-next-unfinished-phase-build.md`
  - Dependency ordering and packet handoff references.
- `docs/operations/agent_execution_commands.md`
  - Integrate TI-041 smoke command matrix into pre-release command runbook.
- `docs/operations/artifacts.md`
  - Define required evidence artifact paths for security smoke execution.

## Security smoke command matrix (authN/authZ/lockout)

| Scenario ID | Command | Expected pass signature | Expected fail signature |
| --- | --- | --- | --- |
| `SMK-AUTHN-01` | `pnpm test:security -- --case authn-invalid-password` | Exit code 0 + output contains `AUTHN_DENIED_EXPECTED` | Exit non-zero or missing marker |
| `SMK-AUTHZ-01` | `pnpm test:security -- --case authz-role-deny` | Exit code 0 + output contains `AUTHZ_DENIED_EXPECTED` | Privileged action unexpectedly allowed |
| `SMK-LOCKOUT-01` | `pnpm test:security -- --case lockout-threshold` | Exit code 0 + output contains `LOCKOUT_TRIGGERED` and `LOCKOUT_WINDOW_ACTIVE` | No lockout marker after threshold reached |
| `SMK-PRIV-01` | `pnpm test:security -- --case privileged-action-block` | Exit code 0 + output contains `PRIV_ACTION_BLOCKED` | Output contains `PRIV_ACTION_EXECUTED` |

## Dependency checkpoints

- [ ] `DEP-TI041-01`: TI-002 role matrix confirms denied-role scenarios in `SMK-AUTHZ-01`.
- [ ] `DEP-TI041-02`: TI-003 lockout/re-auth thresholds reflected in `SMK-LOCKOUT-01` assertions.
- [ ] `DEP-TI041-03`: TI-039 action catalog markers included in privileged-action checks.
- [ ] `DEP-TI041-04`: TI-040 encrypted-field mutation attempts covered in authorization denial paths.

## Validation commands (copy/paste runnable)

- `rg -n "SMK-AUTHN-01|SMK-AUTHZ-01|SMK-LOCKOUT-01|SMK-PRIV-01" docs/exec-plans/active/tracked-issues/TI-041.md`
  - Pass signature: all 4 scenario IDs present.
  - Fail signature: one or more scenario IDs missing.
- `rg -n "AUTHN_DENIED_EXPECTED|AUTHZ_DENIED_EXPECTED|LOCKOUT_TRIGGERED|PRIV_ACTION_BLOCKED" docs/exec-plans/active/tracked-issues/TI-041.md`
  - Pass signature: all required success markers present.
  - Fail signature: missing one or more success markers.
- `rg -n "DEP-TI041-0[1-4]" docs/exec-plans/active/tracked-issues/TI-041.md`
  - Pass signature: 4 dependency checkpoint IDs found.
  - Fail signature: fewer than 4 checkpoint IDs found.

## Required evidence artifacts

- Log path: `artifacts/security/logs/ti-041-security-smoke.log`
- Report file: `artifacts/security/reports/ti-041-smoke-matrix-report.md`
- Hash output: `artifacts/security/hashes/ti-041-smoke-output.sha256`
- Checklist IDs (must be checked in report):
  - `CHK-TI041-01` authN denial scenario validated
  - `CHK-TI041-02` authZ denial scenario validated
  - `CHK-TI041-03` lockout threshold/window validated
  - `CHK-TI041-04` privileged action blocked without required approval chain

## Rollback steps

1. Revert TI-041 documentation edits: `git checkout -- docs/exec-plans/active/tracked-issues/TI-041.md`.
2. Remove invalid smoke evidence artifacts from `artifacts/security/logs`, `artifacts/security/reports`, and `artifacts/security/hashes`.
3. Re-run validation commands to confirm matrix/checkpoint sections were removed by rollback.
4. Capture rollback rationale and remediations in `artifacts/security/reports/ti-041-smoke-matrix-report.md`.
