{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://robodj.local/schema/persona_ops.schema.json",
  "title": "RoboDJ persona operations configuration",
  "type": "object",
  "properties": {
    "schema_version": {
      "type": "string",
      "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$"
    },
    "personas": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "persona_id": { "type": "string" },
          "display_name": { "type": "string" },
          "status": { "type": "string", "enum": ["live", "paused", "disabled"] },
          "live_pointer": { "type": "string" },
          "versions": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "version_id": { "type": "string", "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$" },
                "parent_version_id": { "type": ["string", "null"] },
                "state": { "type": "string", "enum": ["draft", "approved", "live", "deprecated"] },
                "created_at": { "type": "string", "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}T" },
                "approved_at": { "type": "string", "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}T" },
                "go_live_at": { "type": "string", "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}T" },
                "schema": { "type": "object" },
                "rubric_scores": { "type": "object" }
              },
              "required": ["version_id", "state", "created_at", "schema"],
              "additionalProperties": false
            }
          },
          "audit_log": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "event_type": { "type": "string", "enum": ["approve", "go_live", "rollback"] },
                "version_id": { "type": "string" },
                "from_version_id": { "type": "string" },
                "to_version_id": { "type": "string" },
                "actor": { "type": "string" },
                "timestamp": { "type": "string", "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}T" },
                "reason": { "type": "string" }
              },
              "required": ["event_type", "actor", "timestamp", "reason"],
              "additionalProperties": false
            }
          }
        },
        "required": ["persona_id", "display_name", "status", "live_pointer", "versions", "audit_log"],
        "additionalProperties": false
      }
    },
    "experiments": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "experiment_id": { "type": "string" },
          "persona_id": { "type": "string" },
          "status": { "type": "string", "enum": ["draft", "running", "paused", "completed"] },
          "routing": { "type": "object" },
          "variants": { "type": "array", "items": { "type": "object" } },
          "window": { "type": "object" },
          "success_metrics": { "type": "array", "items": { "type": "string" } }
        },
        "required": ["experiment_id", "persona_id", "status", "routing", "variants", "window", "success_metrics"],
        "additionalProperties": false
      }
    },
    "quality_rubric": {
      "type": "object",
      "properties": {
        "dimensions": { "type": "array", "items": { "type": "string" } },
        "scale": {
          "type": "object",
          "properties": {
            "min": { "type": "integer" },
            "max": { "type": "integer" }
          },
          "required": ["min", "max"],
          "additionalProperties": false
        },
        "weights": {
          "type": "object",
          "properties": {
            "warmth": { "type": "number" },
            "clarity": { "type": "number" },
            "authenticity": { "type": "number" },
            "brand_fit": { "type": "number" }
          },
          "required": ["warmth", "clarity", "authenticity", "brand_fit"],
          "additionalProperties": false
        },
        "guardrails": {
          "type": "object",
          "properties": {
            "minimum_dimension_score": { "type": "number" },
            "minimum_trial_composite": { "type": "number" }
          },
          "required": ["minimum_dimension_score", "minimum_trial_composite"],
          "additionalProperties": false
        }
      },
      "required": ["dimensions", "scale", "weights", "guardrails"],
      "additionalProperties": false
    },
    "listener_feedback": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "event_id": { "type": "string" },
          "timestamp": { "type": "string", "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}T" },
          "persona_id": { "type": "string" },
          "persona_version_id": { "type": "string" },
          "experiment_id": { "type": "string" },
          "variant_id": { "type": "string" },
          "daypart": { "type": "string" },
          "audience_segment": { "type": "string" },
          "channel": { "type": "string", "enum": ["thumbs_up", "thumbs_down", "sms", "web_form"] },
          "sentiment": { "type": "number", "minimum": -1, "maximum": 1 },
          "retained_60s": { "type": "boolean" }
        },
        "required": [
          "event_id",
          "timestamp",
          "persona_id",
          "persona_version_id",
          "experiment_id",
          "variant_id",
          "daypart",
          "audience_segment",
          "channel",
          "sentiment",
          "retained_60s"
        ],
        "additionalProperties": false
      }
    }
  },
  "required": ["schema_version", "personas", "experiments", "quality_rubric", "listener_feedback"],
  "additionalProperties": false
}
